DROP TABLE PUBLICACION CASCADE CONSTRAINT;
DROP TABLE HISTORIAL CASCADE CONSTRAINT;
DROP TABLE COMPRA CASCADE CONSTRAINT;
DROP TABLE CLIENTE_REG CASCADE CONSTRAINT;
DROP TABLE CLIENTE CASCADE CONSTRAINT;
DROP TABLE PEDIDO CASCADE CONSTRAINT;
DROP TABLE PRODUCTO CASCADE CONSTRAINT;
DROP TABLE REFERENCIAS CASCADE CONSTRAINT;
DROP TABLE TARJETAS CASCADE CONSTRAINT;
DROP TABLE PROVEEDORES CASCADE CONSTRAINT;
DROP TABLE FACTURACION CASCADE CONSTRAINT;
DROP TABLE DELIVERY CASCADE CONSTRAINT;

CREATE TABLE DELIVERY(
tipo_via VARCHAR2(10),
nombre_via VARCHAR2(30),
localidad VARCHAR2(45),
pais VARCHAR2(45),
codigo_postal VARCHAR2(5),
fecha_recepcion VARCHAR2(14),
hora_recepcion VARCHAR2(14),
inmueble VARCHAR2(3),
n_bloque VARCHAR2(1),
escalera VARCHAR2(2),
piso VARCHAR2(7),
puerta VARCHAR2(2),
CONSTRAINT PK_DELIVERY PRIMARY KEY (tipo_via,nombre_via,localidad,pais,codigo_postal,fecha_recepcion,hora_recepcion)
);

CREATE TABLE FACTURACION(
tipo_via VARCHAR2(10),
nombre_via VARCHAR2(30),
localidad VARCHAR2(45),
pais VARCHAR2(45),
codigo_postal VARCHAR2(5),
inmueble VARCHAR2(3),
n_bloque VARCHAR2(1),
escalera VARCHAR2(2),
piso VARCHAR2(7),
puerta VARCHAR2(1),
CONSTRAINT PK_FACTURACION PRIMARY KEY (tipo_via,nombre_via,localidad,pais,codigo_postal)
);

CREATE TABLE PROVEEDORES(
id_proveedor NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
cif VARCHAR2(10) NOT NULL,
nombre VARCHAR2(90) NOT NULL,
nombre_comercial VARCHAR2(35) NOT NULL,
correo VARCHAR2(120) NOT NULL,
telefono VARCHAR2(9) NOT NULL,
ncuenta VARCHAR2(30) NOT NULL,
dir_postal VARCHAR2(120) NOT NULL,
pais VARCHAR2(45) NOT NULL,
tmedioanual VARCHAR2(150) NOT NULL,
coste VARCHAR2(14) NOT NULL,
npedidos VARCHAR2(150) NOT NULL,
CONSTRAINT PK_PROVEEDORES PRIMARY KEY (id_proveedor)
);


CREATE TABLE REFERENCIAS(
id_referencia NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
cod_barras VARCHAR2(15) NOT NULL,
descripcion VARCHAR2(150) NOT NULL,
precio VARCHAR2(12) NOT NULL,
stock VARCHAR2(5) NOT NULL,
min_stock VARCHAR2(5) NOT NULL,
max_stock VARCHAR2(5) NOT NULL,
CONSTRAINT PK_REFERENCIAS PRIMARY KEY (id_referencia),
CONSTRAINT CK_STOCKMIN CHECK (min_stock>4),
CONSTRAINT CK_MAX_STOCK CHECK (max_stock >14)
);


CREATE TABLE PRODUCTO(
id_producto NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
nombre VARCHAR2(50) NOT NULL,
coffea VARCHAR2(20) NOT NULL,
varietal VARCHAR2(30) NOT NULL,
origen VARCHAR2(15) NOT NULL,
tostado VARCHAR2(10) NOT NULL,
packaging VARCHAR2(15) NOT NULL,
comercializacion VARCHAR2(20),
descafeinado VARCHAR2(12) NOT NULL, 
referencia NUMBER,
CONSTRAINT PK_PRODUCTO PRIMARY KEY(id_producto),
CONSTRAINT FK_PRODUCTO FOREIGN KEY(referencia) REFERENCES REFERENCIAS(id_referencia)
);


CREATE TABLE PEDIDO(
id_pedido NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
fecha_pedido VARCHAR2(14) NOT NULL,
hora_pedido VARCHAR2(14) NOT NULL,
referencia VARCHAR2(15) NOT NULL,
cantidad_solicitada VARCHAR2(150) NOT NULL,
nombre_producto VARCHAR2(50) NOT NULL,
coffea VARCHAR2(20) NOT NULL,
varietal VARCHAR2(30) NOT NULL,
origen VARCHAR2(15) NOT NULL,
tostado VARCHAR2(10) NOT NULL,
packaging VARCHAR2(15) NOT NULL,
comercializacion VARCHAR2(20) NOT NULL,
CONSTRAINT PK_PEDIDO PRIMARY KEY (id_pedido)
);



CREATE TABLE CLIENTE(
id_cliente NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
correo VARCHAR2(60),
telefono VARCHAR2(9),
nombre VARCHAR2(35) NOT NULL,
apellido1 VARCHAR2(30) NOT NULL,
apellido2 VARCHAR2(30),
tipo_via_fact VARCHAR2(10),
nombre_via_fact VARCHAR2(30),
localidad_fact VARCHAR2(45),
pais_fact VARCHAR2(45),
codigo_postal_fact VARCHAR2(5),
tipo_via_del VARCHAR2(10),
nombre_via_del VARCHAR2(30),
localidad_del VARCHAR2(45),
pais_del VARCHAR2(45),
codigo_postal_del VARCHAR2(5),
fecha_recep_del VARCHAR2(14),
hora_recep_del VARCHAR2(14),
CONSTRAINT PK_CLIENTE PRIMARY KEY(id_cliente),
CONSTRAINT CHK_CORREO_TELEFONO CHECK (correo IS NOT NULL OR telefono IS NOT NULL),
CONSTRAINT FK_TIPO_VIA_FACTURACION FOREIGN KEY(tipo_via_fact,nombre_via_fact,localidad_fact,pais_fact,codigo_postal_fact) REFERENCES FACTURACION(tipo_via,nombre_via,localidad,pais,codigo_postal) ON DELETE CASCADE,
CONSTRAINT FK_TIPO_VIA_DELIVERY FOREIGN KEY(tipo_via_del,nombre_via_del,localidad_del,pais_del,codigo_postal_del,fecha_recep_del,hora_recep_del) REFERENCES DELIVERY(tipo_via,nombre_via,localidad,pais,codigo_postal,fecha_recepcion,hora_recepcion) ON DELETE CASCADE
);

CREATE TABLE CLIENTE_REG(
id_cliente NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
n_usuario VARCHAR2(30) NOT NULL,
contra VARCHAR2(15) NOT NULL,
correo VARCHAR2(60),
telefono VARCHAR2(9),
fecha_reg VARCHAR2(14) NOT NULL,
hora_reg VARCHAR2(14) NOT NULL,
descuentos VARCHAR2(3) NOT NULL,
n_tarjeta VARCHAR2(20)  UNIQUE NOT NULL,
titular VARCHAR2(30) NOT NULL,
company VARCHAR2(15) NOT NULL,
fecha_vencimiento VARCHAR2(7) NOT NULL,
CONSTRAINT PK_CLIENTE_REG PRIMARY KEY(id_cliente),
CONSTRAINT CHK_CORREO_TELEFONO2 CHECK (correo IS NOT NULL OR telefono IS NOT NULL),
CONSTRAINT FK_CLIENTEREG_CLIENTE FOREIGN KEY (id_cliente) REFERENCES CLIENTE(id_cliente)
);





CREATE TABLE COMPRA(
id_cliente NUMBER,
fecha_pago VARCHAR2(14),
hora_pago VARCHAR2(14),
referencia VARCHAR2(15), 
cliente_correo VARCHAR2(60),
cliente_telefono VARCHAR2(9),
tipo_pago VARCHAR2(15) NOT NULL,
precio_total VARCHAR2(10) NOT NULL,
CONSTRAINT PK_COMPRA PRIMARY KEY (fecha_pago, hora_pago,referencia),
CONSTRAINT CHK_CORREO_TELEFONO_COMPRA CHECK (cliente_correo IS NOT NULL OR cliente_telefono IS NOT NULL),
CONSTRAINT FK_COMPRA_CLIENTES FOREIGN KEY(id_cliente) REFERENCES CLIENTE(id_cliente) ON DELETE CASCADE
);



CREATE TABLE HISTORIAL(
id_historial NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
cliente_correo VARCHAR2(60),
cliente_telefono VARCHAR2(9),
nombre_producto VARCHAR2(50) NOT NULL,
coffea VARCHAR2(20) NOT NULL,
varietal VARCHAR2(30) NOT NULL,
origen VARCHAR2(15) NOT NULL,
tostado VARCHAR2(10) NOT NULL,
packaging VARCHAR2(15) NOT NULL,
comercializacion VARCHAR2(20) NOT NULL,
id_cliente NUMBER,
fecha_pago VARCHAR2(14),
hora_pago VARCHAR2(14),
referencia VARCHAR2(15),
CONSTRAINT PK_HISTORIAL PRIMARY KEY(id_historial),
CONSTRAINT CHK_CORREO_TELEFONO3 CHECK (cliente_correo IS NOT NULL OR cliente_telefono IS NOT NULL),
CONSTRAINT FK_HISTORIAL_CLIENTE FOREIGN KEY (id_cliente) REFERENCES CLIENTE(id_cliente) ON DELETE CASCADE,
CONSTRAINT FK_COMPRA_HISTORIAL FOREIGN KEY(fecha_pago,hora_pago,referencia) REFERENCES COMPRA(fecha_pago,hora_pago,referencia)
);




CREATE TABLE PUBLICACION(
n_usuario VARCHAR2(30),
producto VARCHAR2(50),
referencia VARCHAR2(15),
fecha_publi VARCHAR2(14),
hora_publi VARCHAR2(14),
contenido VARCHAR2(2000) NOT NULL,
titulo VARCHAR2(50) NOT NULL,
likes VARCHAR2(9) NOT NULL,
puntuacion VARCHAR2(1) CHECK (puntuacion IN (1,2,3,4,5)),
refrendado VARCHAR2(50),
CONSTRAINT PK_PUBLICACION PRIMARY KEY (n_usuario,producto, referencia, fecha_publi,hora_publi)
);

